{"ast":null,"code":"import _regeneratorRuntime from\"/home/gmr/guiminr/E-Commerce-React/ecommerce/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/gmr/guiminr/E-Commerce-React/ecommerce/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import{Typography,Button,Divider}from'@material-ui/core';import{Elements,CardElement,ElementsConsumer}from'@stripe/react-stripe-js';import{loadStripe}from'@stripe/stripe-js';import Review from'./Review';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var stripePromise=loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);var PaymentForm=function PaymentForm(_ref){var checkoutToken=_ref.checkoutToken,shippingData=_ref.shippingData,backStep=_ref.backStep,onCaptureCheckout=_ref.onCaptureCheckout,nextStep=_ref.nextStep,timeout=_ref.timeout;var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event,elements,stripe){var cardElement,_yield$stripe$createP,error,paymentMethod,orderData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:cardElement=elements.getElement(CardElement);_context.next=6;return stripe.createPaymentMethod({type:'card',card:cardElement});case 6:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){console.log(error);}else{orderData={line_items:checkoutToken.live.line_items,customer:{firstname:shippingData.firstname,lastname:shippingData.lastname,email:shippingData.email},shipping:{name:'Primary',street:shippingData.address1,town_city:shippingData.city,county_state:shippingData.shippingSubdivision,postal_zip_code:shippingData.zip,country:shippingData.shippingCountry},fulfillment:{shipping_method:shippingData.shippingOption},payment:{gateway:'stripe',stripe:{payment_method_id:paymentMethod.id}}};onCaptureCheckout(checkoutToken.id,orderData);timeout();nextStep();}case 10:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Review,{checkoutToken:checkoutToken}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,style:{margin:'20px 0'},children:\"Payment method\"}),/*#__PURE__*/_jsx(Elements,{stripe:stripePromise,children:/*#__PURE__*/_jsx(ElementsConsumer,{children:function children(_ref3){var elements=_ref3.elements,stripe=_ref3.stripe;return/*#__PURE__*/_jsxs(\"form\",{onSubmit:function onSubmit(e){return handleSubmit(e,elements,stripe);},children:[/*#__PURE__*/_jsx(CardElement,{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:backStep,children:\"Back\"}),/*#__PURE__*/_jsxs(Button,{type:\"submit\",variant:\"contained\",disable:!stripe,color:\"primary\",children:[\"Pay \",checkoutToken.live.subtotal.formatted_with_symbol]})]})]});}})})]});};export default PaymentForm;","map":{"version":3,"sources":["/home/gmr/guiminr/E-Commerce-React/ecommerce/src/componets/CheckoutForm/PaymentForm.jsx"],"names":["React","Typography","Button","Divider","Elements","CardElement","ElementsConsumer","loadStripe","Review","stripePromise","process","env","REACT_APP_STRIPE_PUBLIC_KEY","PaymentForm","checkoutToken","shippingData","backStep","onCaptureCheckout","nextStep","timeout","handleSubmit","event","elements","stripe","preventDefault","cardElement","getElement","createPaymentMethod","type","card","error","paymentMethod","console","log","orderData","line_items","live","customer","firstname","lastname","email","shipping","name","street","address1","town_city","city","county_state","shippingSubdivision","postal_zip_code","zip","country","shippingCountry","fulfillment","shipping_method","shippingOption","payment","gateway","payment_method_id","id","margin","e","display","justifyContent","subtotal","formatted_with_symbol"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Typography, Button, Divider } from '@material-ui/core';\nimport {Elements, CardElement, ElementsConsumer } from '@stripe/react-stripe-js';\nimport {loadStripe} from '@stripe/stripe-js';\nimport Review from './Review';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\n\nconst PaymentForm = ({checkoutToken, shippingData, backStep, onCaptureCheckout, nextStep, timeout}) => {\n    const handleSubmit = async (event, elements, stripe) => {\n        event.preventDefault();\n\n        if (!stripe || !elements) return;\n\n        const cardElement = elements.getElement(CardElement);\n        const {error, paymentMethod} = await stripe.createPaymentMethod({type: 'card', card: cardElement});\n        if (error) {\n            console.log(error);\n        } else {\n            const orderData = {\n                line_items: checkoutToken.live.line_items,\n                customer: {firstname: shippingData.firstname, lastname: shippingData.lastname, email: shippingData.email },\n                shipping: {\n                    name: 'Primary', \n                    street: shippingData.address1, \n                    town_city: shippingData.city,\n                    county_state: shippingData.shippingSubdivision,\n                    postal_zip_code: shippingData.zip,\n                    country: shippingData.shippingCountry,\n                },\n                fulfillment: { shipping_method: shippingData.shippingOption},\n                payment: {\n                    gateway: 'stripe',\n                    stripe: {\n                        payment_method_id: paymentMethod.id\n                    }\n                }\n            }\n\n            onCaptureCheckout(checkoutToken.id, orderData);\n            timeout();\n            nextStep();\n        }\n    }\n\n    return (\n        <>\n           <Review checkoutToken={checkoutToken} />\n           <Divider />\n           <Typography variant=\"h6\" gutterBottom style={{ margin: '20px 0'}}>Payment method</Typography>\n           <Elements stripe={stripePromise}>\n             <ElementsConsumer>\n                 {({elements, stripe}) => (\n                    <form onSubmit={(e) => handleSubmit(e, elements, stripe)}>\n                        <CardElement />\n                        <br/><br/>\n                        <div style={{ display: 'flex', justifyContent: 'space-between'}}>\n                            <Button variant=\"outlined\" onClick={backStep}>Back</Button>\n                            <Button type=\"submit\" variant=\"contained\" disable={!stripe} color=\"primary\">\n                                Pay {checkoutToken.live.subtotal.formatted_with_symbol }\n                            </Button>\n                        </div>\n                    </form>\n                 )}\n             </ElementsConsumer>\n           </Elements>\n        </>\n    )\n}\n\nexport default PaymentForm\n"]},"metadata":{},"sourceType":"module"}